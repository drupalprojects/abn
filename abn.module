<?php
/**
 * @file
 * Defines an ABN (Australian Business Number) field type.
 */

module_load_include('inc', 'abn', 'abn.field');

/**
 * Implements hook_menu().
 */
function abn_menu() {
  // AJAX callback to lookup an ABN.
  $items['ajax/abn_lookup/%'] = array(
    'title' => 'ABN Lookup',
    'page callback' => 'abn_lookup_callback',
    'access arguments' => array('access content'),
    'type' => MENU_CALLBACK,
    'file' => 'abn.pages.inc',
  );
}

/**
 * Performs an ABN lookup and returns the parsed results.
 */
function abn_lookup($abn) {
  $request = drupal_http_request('http://www.abr.business.gov.au/SearchByAbn.aspx?SearchText=74+599+608+295');
  return uniqid();
}

/**
 * Implements hook_init().
 */
function abn_init() {
 $field_types = field_info_fields();
 foreach($field_types as $field_type) {
  if($field_type['type'] == 'abn') {
  }
 }
}

/**
 * Takes a field $item and syncs extra information from the ABR as required.
 *
 * $item is modified by reference.
 */
function _abn_sync_field_item(&$item) {
  $lookup = abn_lookup($item['abn']);

  $item['abn_entity_name'] = $lookup;
  $item['updated'] = $_SERVER['REQUEST_TIME'];
}
